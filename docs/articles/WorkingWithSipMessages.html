<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Introduction </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Introduction ">
    
    
      <link rel="shortcut icon" href="../favicon.ico">
      <link rel="stylesheet" href="../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../styles/docfx.css">
      <link rel="stylesheet" href="../styles/main.css">
      <meta property="docfx:navrel" content="../toc.json">
      <meta property="docfx:tocrel" content="toc.json">
    
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>

                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../articles/intro.html" title="Articles">Articles</a>
                      </li>
                      <li>
                          <a href="../api/index.html" title="Api Documentation">Api Documentation</a>
                      </li>
                </ul>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">

                  <ul class="nav level1">
                    <li class="">
                      <a href="intro.html" title="Introduction" class="">Introduction</a>
                    </li>
                    <li class="">
                      <a href="SipTransportManagement.html" title="SIP Message Transport Management" class="">SIP Message Transport Management</a>
                    </li>
                    <li class="">
                      <a href="SipChannelClasses.html" title="SIP Channel Classes" class="">SIP Channel Classes</a>
                    </li>
                    <li class="active">
                      <a href="WorkingWithSipMessages.html" title="Working with SIP Messages" class="active">Working with SIP Messages</a>
                    </li>
                    <li class="">
                      <a href="SessionDescriptionProtocol.html" title="Session Description Protocol" class="">Session Description Protocol</a>
                    </li>
                    <li class="">
                      <a href="RealTimeProtocol.html" title="Real Time Protocol" class="">Real Time Protocol</a>
                    </li>
                    <li class="">
                      <a href="ConfigureSipLibLogging.html" title="SipLib Application Logging" class="">SipLib Application Logging</a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="introduction">Introduction</h1>

<p>The following table lists the key namespaces that relate to the processing of SIP messages.</p>
<table>
<thead>
<tr>
<th>Namespace</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SipLib.Core</td>
<td>Contains classes for building and processing SIP messages.</td>
</tr>
<tr>
<td>SipLib.Body</td>
<td>Contains classes for building and processing the body contents of a SIPRequest or a SIPResponse. The classes support simple message bodies or multipart/mixed message bodies.</td>
</tr>
<tr>
<td>SipLib.Sdp</td>
<td>Contains classes for the Session Description Protocol (SDP)</td>
</tr>
</tbody>
</table>
<h1 id="sip-messages">SIP Messages</h1>
<p>The <a href="../api/SipLib.Core.SIPMessage.html">SIPMessage</a> class is the base class for SIP requests and SIP responses. Applications do not work with the SIPMessage class directly.</p>
<h2 id="sip-requests">SIP Requests</h2>
<p>The <a href="../api/SipLib.Core.SIPRequest.html">SIPRequest</a> class represents a SIP request message. The SIPRequest class consists of the following key components.</p>
<ol>
<li>Request line consisting of a request method and a request URI</li>
<li>SIP message headers encapusulated in a field called Header which is of type <a href="../api/SipLib.Core.SIPHeader.html">SIPHeader</a></li>
<li>An optional message body</li>
</ol>
<p>Applications typically receive a SIPRequest object as a parameter of an event handler of an event generated by a <a href="../api/SipLib.Channels.SipTransport.html">SipTransport</a> or a <a href="../api/SipLib.Channels.SIPChannel.html">SIPChannel</a> derived object.</p>
<p>The Method field of a SIPRequest object is of type <a href="../api/SipLib.Core.SIPMethodsEnum.html">SIPMethodsEnum</a> and can be used to determine the type of request (INVITE, BYE, etc.).</p>
<p>The URI field of a SIPRequest object is of type <a href="../api/SipLib.Core.SIPURI.html">SIPURI</a> and it contains the request URI from the request line. This field identifies the resource being requested by the sender of the SIPRequest message.</p>
<p>The Header field is of type <a href="../api/SipLib.Core.SIPHeader.html">SIPHeader</a> and contains objects for each SIP header of the request.</p>
<p>The message body may be contained in the Body field of a SIPRequest. This field is a string. Applications can use the helper classes described in <a href="#MessageBodyProcessing">Received SIP Message Body Processing</a> to parse and process the message body.</p>
<p>The SIPRequest class has a static method called CreateBasicRequest() that can be used for building a SIPRequest. The declaration of this method is:</p>
<pre><code>public static SIPRequest CreateBasicRequest(SIPMethodsEnum Method, SIPURI reqUri,
    SIPURI ToSipUri, string? ToDisplayName, SIPURI FromSipUri, string? FromDisplayName)
</code></pre>
<p>The CreateBasicRequest() method creates a new SIPRequest object with a request line and adds the following SIP headers.</p>
<ol>
<li>From</li>
<li>To</li>
<li>Via</li>
<li>Contact</li>
<li>Call-ID</li>
<li>Max-Forwards (set to 70)</li>
<li>Content-Length (set to 0)</li>
<li>CSeq</li>
</ol>
<p>Applications can modify these headers and add new new headers.</p>
<p>Applications can add a body to the SIPRequest message using the methods described in <a href="#BuildingMessageBodies">Building SIP Message Bodies</a>.</p>
<h2 id="sip-responses">SIP Responses</h2>
<p>The <a href="../api/SipLib.Core.SIPResponse.html">SIPResponse</a> class represents a SIP response message. The SIPResponse class consists of the following key components.</p>
<ol>
<li>A status line containing a response code and a response reason string</li>
<li>SIP message headers encapusulated in a field called Header which is of type SIPHeader</li>
<li>An optional message body</li>
</ol>
<p>Applications typically receive a SIPResponse object as a parameter of an event handler of an event generated by a <a href="../api/SipLib.Channels.SipTransport.html">SipTransport</a> or a <a href="../api/SipLib.Channels.SIPChannel.html">SIPChannel</a> derived object.</p>
<p>The Status field is of type <a href="../api/SipLib.Core.SIPResponseStatusCodesEnum.html">SIPResponseStatusCodesEnum</a> and the StatusCode field is the numeric representation of the Status enumeration. These fields should be used to determine the type of the response message.</p>
<p>The Header field is of type <a href="../api/SipLib.Core.SIPHeader.html">SIPHeader</a> and contains objects for each SIP header of the response.</p>
<p>The message body may be contained in the Body field of a SIPResponse. This field is a string. Applications can use the helper classes described in <a href="#MessageBodyProcessing">Received SIP Message Body Processing</a> to parse and process the message body.</p>
<p>Applications build SIPResponse objects in response to SIPRequest message objects that they receive. They can do so by using the constructors of the SIPResponse class and fill in the status code, headers and body of the new SIPResponse object.</p>
<p>The <a href="../api/SipLib.Core.SipUtils.html">SipUtils</a> class has a static helper method called BuildResponse() that can greatly simplify construction of new SIPResponse objects. The declaration of this method is:</p>
<pre><code>public static SIPResponse BuildResponse(SIPRequest Sr, SIPResponseStatusCodesEnum StatCode,
    string ReasonPhrase, SIPChannel sipChannel, string? SipUserName);
</code></pre>
<p>This method returns a SIPResponse object that the application can send to the originator of a SIPRequest with the following header fields set.</p>
<ol>
<li>To</li>
<li>From</li>
<li>Via</li>
<li>Record-Route</li>
<li>CSeq</li>
<li>Call-ID</li>
<li>Contact</li>
<li>Content-Length (set to 0)</li>
<li>Max-Forwards</li>
</ol>
<p>Applications can add a body to the SIPResponse message using the methods described in <a href="#BuildingMessageBodies">Building SIP Message Bodies</a>.</p>
<h2 id="sip-message-bodies">SIP Message Bodies</h2>
<p>Both SIP requests and SIP responses may have a message body.</p>
<h3 id="received-sip-message-body-processing"><a name="MessageBodyProcessing">Received SIP Message Body Processing</a></h3>
<p>The following discussion applies to SIP messages that have been received by an application.</p>
<p>The HasBody() method of a SIPRequest or a SIPResponse object returns true if the message has body or false if it does not. You can call the GetBodyContents() method of a SIPRequest or a SIPResponse object to get a list of body parts. The definition of this method is:</p>
<pre><code>public List&lt;MessageContentsContainer&gt; GetBodyContents();
</code></pre>
<p>The returned list will always be non-null, even if the message does not have a body. You can enumerate through the returned list object to parse and process each body part.</p>
<p>The <a href="../api/SipLib.Body.MessageContentsContainer.html">MessageContentsContainer</a> class is used to contain information about a body contents block.</p>
<p>The following code sample shows how to process a SIPRequest containing SDP data and NG9-1-1 location information. The same logic pertains to the SIPResponse class.</p>
<pre><code>using SipLib.Core;
using SipLib.Body;
using SipLib.Sdp;

// Import Ng911Lib from NuGet to use
using Ng911Lib.Utilities;
using Pidf;
...

private void ProcessSipRequest(SIPRequest sipRequest)
{
    List&lt;MessageContentsContainer&gt; containers = sipRequest.GetBodyContents();
    foreach (MessageContentsContainer container in containers)
    {
        if (string.IsNullOrEmpty(container.StringContents) == true)
            continue; // Skip, log it or do something

        switch (container.ContentType)
        {
            case ContentTypes.sdp:
                ProcessSdp(container.StringContents);
                break;
            case ContentTypes.Pidf:
                ProcessPidf(container.StringContents);
                break;
        }
    }
}

private void ProcessSdp(string strSdp)
{
    Sdp sdp = Sdp.ParseSDP(strSdp);
    // Process the sdp object
}

private void ProcessPidf(string strPidf)
{
    Presence presence = XmlHelper.DeserializeFromString&lt;Presence&gt;(strPidf);
    if (presence != null)
    {
        // Process the location data
    }
}

</code></pre>
<p>The GetContentsContainer() method returns the body part for a specified MIME body type.</p>
<pre><code>public MessageContentsContainer? GetContentsContainer(string contentType);
</code></pre>
<p>For example, the following code gets the contents container for the SDP.</p>
<pre><code>using SipLib.Core;
using SipLib.Body;
using SipLib.Sdp;
...

private void ProcessSipRequest(SIPRequest sipRequest)
{
    MessageContentsContainer? sdpContainer = sipRequest.GetContentsContainer(
        ContentTypes.Sdp);
    if (sdpContainer != null &amp;&amp; sdpContainer.StringContents != null)
    {
        Sdp sdp = Sdp.ParseSDP(sdpContainer.StringContents);
        // Process the sdp object
    }
}
</code></pre>
<p>The <a href="../api/SipLib.Body.ContentTypes.html">ContentTypes</a> class provides named fields that are constant string values for each known MIME type. Use the fields in this class instead of quoted string values to ensure consistency and avoid coding errors.</p>
<h3 id="building-sip-message-bodies"><a name="BuildingMessageBodies">Building SIP Message Bodies</a></h3>
<p>The <a href="../api/SipLib.Body.SipBodyBuilder.html">SipBodyBuilder</a> class can be used to build simple or multipart/mixed SIP message bodies and attach the message body to a SIPRequest or a SIPResponse message.</p>
<p>Follow these steps to use the SipBodyBuilder class to add a body to a SIP message.</p>
<ol>
<li>Create an instance of the SipBodyBuilder class</li>
<li>Convert the object to add to the body to a string</li>
<li>Call the AddContent() method of the SipBodyBuilder class for each body part that needs to be attached to the SIP message</li>
<li>Call the AttachMessageBody() method of the SipBodyBuilder class with the SIPRequest or the SIPResponse object</li>
</ol>
<p>The AttachMessageBody() method performs the following actions.</p>
<ol>
<li>Concactenates each body part into a string and sets the Body field of the SIPMessage derived object</li>
<li>Calculates the total contents length and sets the Content-Length header of the SIPMessage derived object</li>
<li>Determines the appropriage Content-Type header value and sets the Content-Type header field for the message</li>
</ol>
<p>The following code sample shows how to use the SipBodyBuilder class.</p>
<pre><code>using SipLib.Core;
using SipLib.Body;
using SipLib.Sdp;
...

private void AttachSdp(SIPRequest sipRequest)
{
    SipBodyBuilder bodyBuilder = new SipBodyBuilder();
    Sdp sdp = SdpUtils.BuildSimpleAudioSdp(&quot;192.168.1.100, 7000, &quot;MyUaName&quot;);
    bodyBuilder.AddContent(ContentTypes.sdp, sdp.ToString());
    bodyBuilder.AttachMessageBody(sipRequest);
}
</code></pre>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
